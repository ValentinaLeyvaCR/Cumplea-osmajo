<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¬°Feliz Cumple, Mar√≠a Jos√©!</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* Estilos CSS (Sin cambios, id√©ntico al anterior) */
        body, html { margin: 0; padding: 0; font-family: 'Kalam', cursive; overflow: hidden; height: 100%; background-color: #f0f8ff; touch-action: manipulation; }
        .page { width: 100%; height: 100vh; position: absolute; top: 0; left: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.5s ease; visibility: hidden; opacity: 0; padding: 20px; box-sizing: border-box; line-height: 1.6; }
        .page.active { visibility: visible; opacity: 1; }
        h1 { font-size: 2.2em; color: #ff69b4; text-align: center; text-shadow: 2px 2px #fff; }
        p { font-size: 1.2em; text-align: center; color: #555; }
        .gabby-button { background: linear-gradient(145deg, #ffb6c1, #ffa0ac); border: 2px solid #ff69b4; color: #fff; padding: 15px 30px; font-size: 1.1em; font-family: 'Kalam', cursive; font-weight: 700; border-radius: 50px; cursor: pointer; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); transition: all 0.2s ease; -webkit-tap-highlight-color: transparent; width: 90%; max-width: 300px; text-align: center; margin-bottom: 15px; }
        .gabby-button:hover { background: linear-gradient(145deg, #ffc1cb, #ffb0bc); transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15); }
        .gabby-button:active { transform: translateY(1px); box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); }
        a.gabby-button { text-decoration: none; box-sizing: border-box; }
        @keyframes magicShimmer { 0% { box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1), 0 0 10px #fff, 0 0 20px #ffc1cb; } 50% { box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1), 0 0 30px #fff, 0 0 40px #f0e68c; } 100% { box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1), 0 0 10px #fff, 0 0 20px #ffc1cb; } }
        .shimmer-button { animation: magicShimmer 2s infinite; }
        @keyframes boingBounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        .bounce-button:hover { animation: boingBounce 0.5s ease; }
        #page-bienvenida { background-color: #f0f8ff; background-image: radial-gradient(circle, rgba(255,192,203,0.3) 0%, rgba(255,192,203,0) 70%); }
        #page-bienvenida .animated-message { font-size: 1.3em; color: #ff69b4; opacity: 0; animation: fadeIn 2s ease 1s forwards; font-weight: 700; }
        @keyframes fadeIn { to { opacity: 1; } }
        #page-portada { background: linear-gradient(to bottom, #ffffff, #fdf5e6); }
        #page-portada .logo { width: 250px; max-width: 80%; border-radius: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        #page-portada h1 { color: #6a5acd; font-size: 1.8em; }
        #page-historia { background-color: #e6e6fa; overflow-y: auto; justify-content: flex-start; }
        .historia-container { display: flex; flex-direction: column; gap: 20px; align-items: center; justify-content: flex-start; width: 100%; }
        .historia-container img { width: 250px; max-width: 80%; margin-top: 10px; }
        .cuento-bloque { background: rgba(255, 255, 255, 0.9); border: 4px solid #ffb6c1; border-radius: 20px; padding: 15px; width: 90%; max-width: 500px; font-size: 1.1em; line-height: 1.6; color: #333; text-align: center; }
        .cuento-bloque strong { color: #ff69b4; }
        .historia-botones { margin-top: 15px; display: flex; flex-direction: column; gap: 15px; width: 100%; align-items: center; padding-bottom: 30px; }
        #sorpresa-popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 182, 193, 0.85); backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; visibility: hidden; opacity: 0; transition: all 0.3s ease; z-index: 100; padding: 20px; box-sizing: border-box; }
        #sorpresa-popup.active { visibility: visible; opacity: 1; }
        .sorpresa-content { position: relative; padding: 30px 20px; border: 5px solid #fff; border-radius: 20px; box-shadow: 0 0 30px rgba(0,0,0,0.5); text-align: center; width: 90%; max-width: 500px; background: #ff69b4; }
        #typewriter-text { font-family: 'Kalam', cursive; font-weight: 700; font-size: 1.5em; color: #fff; line-height: 1.6; text-shadow: 2px 2px #c71585; }
        .close-popup { position: absolute; top: 5px; right: 10px; font-size: 40px; color: #fff; cursor: pointer; background: none; border: none; width: auto; box-shadow: none; margin-bottom: 0; }
        @keyframes fall { 0% { top: -10%; transform: rotate(0deg); } 100% { top: 110%; transform: rotate(360deg); } }
        .confetti { position: absolute; font-size: 2em; animation: fall linear infinite; top: -10%; color: white; }
        #page-cierre { background-color: #fffaf0; overflow-y: auto; justify-content: center; padding-top: 50px; padding-bottom: 50px; }
        #page-cierre .logo { width: 200px; max-width: 70%; border-radius: 20px; }
        #page-cierre .lema { font-size: 1.1em; color: #555; margin-top: -15px; }
        #page-cierre .frase-final { font-size: 1.3em; color: #ff69b4; font-weight: 700; margin-top: 30px; margin-bottom: 30px; text-shadow: 1px 1px #fff; }
        #page-certificado { background: #fdf5e6; overflow-y: auto; justify-content: flex-start; }
        .certificado-content { width: 95%; max-width: 700px; background: #fff; border: 10px solid #ffb6c1; border-radius: 20px; padding: 20px; box-sizing: border-box; text-align: center; color: #333; margin-top: 20px; }
        .certificado-content h1 { color: #ff69b4; font-size: 1.5em; text-shadow: none; }
        .certificado-body { font-size: 1.1em; line-height: 2; margin-top: 20px; margin-bottom: 30px; }
        .campo-rellenable { font-weight: 700; color: #000; font-size: 1.2em; background: #f0f8ff; padding: 5px 10px; border-radius: 10px; }
        .campo-static { font-weight: 700; color: #c71585; font-size: 1.3em; padding: 5px; }
        @media (min-width: 768px) { h1 { font-size: 3em; } p { font-size: 1.3em; } .gabby-button { width: auto; max-width: none; } .close-popup { width: auto; } #page-bienvenida .animated-message { font-size: 1.8em; } #page-portada .logo { width: 300px; } #page-historia { overflow-y: hidden; justify-content: center;} .historia-container { flex-direction: row; gap: 30px; padding: 40px; max-width: 1000px; justify-content: center; align-items: center; } .historia-container img { width: 300px; margin-top: 0; } .cuento-bloque { width: 500px; font-size: 1.2em; padding: 30px; } .historia-botones { flex-direction: column; gap: 15px; width: auto; padding-bottom: 0; } .sorpresa-content { width: auto; padding: 50px; } #typewriter-text { font-size: 2em; } #page-cierre { overflow-y: hidden; justify-content: center; padding-top: 20px; padding-bottom: 20px; } #page-cierre .logo { width: 250px; } #page-cierre .lema { font-size: 1.3em; } #page-cierre .frase-final { font-size: 1.8em; } .certificado-content { width: 700px; padding: 40px; margin-top: 0;} .certificado-content h1 { font-size: 2.2em; } .certificado-body { font-size: 1.3em; } }
    </style>
</head>
<body>

    <div id="page-bienvenida" class="page active">
        <h1>¬°Hola, Mar√≠a Jos√©!</h1>
        <p class="animated-message">¬°Un regalo te espera...!</p>
        <button id="btn-comenzar" class="gabby-button shimmer-button">¬°Abrir!</button>
    </div>

    <div id="page-portada" class="page">
        <img src="logo.png" alt="Logo Trapo de Luz" class="logo">
        <h1>¬°Pasaporte de Fiesta!</h1>
        <button id="btn-entrar" class="gabby-button">¬°Entrar!</button>
    </div>

    <div id="page-historia" class="page">
        <div class="historia-container">
            <img src="pandy.png" alt="Mu√±eco Pandy Paws">
            <div class="cuento-bloque">
                <p><strong>¬°Hola, Mar√≠a Jos√©!</strong></p>
                <p>¬°Bienvenida a la Casa de Mu√±ecas! Soy Pandy Paws y estoy muy emocionado de celebrar tu cumplea√±os.</p>
                <p>¬°Prep√°rate para una aventura "Miau-ravillosa" llena de abrazos, sorpresas y mucha diversi√≥n!</p>
                <p><strong>¬°Vamos a jugar!</strong></p>
            </div>
        </div>
        
        <div class="historia-botones">
            <button id="btn-certificado" class="gabby-button">üíå Ver Tarjeta</button>
            <button id="btn-sorpresa" class="gabby-button">üéÅ Sorpresa</button>
            <a href="https://www.instagram.com/trapodeluz/" target="_blank" class="gabby-button">
                ¬°Mira m√°s personajes! üì∏
            </a>
        </div>
    </div>

    <div id="page-cierre" class="page">
        <img src="logo.png" alt="Logo Trapo de Luz" class="logo">
        <p class="lema">"Cada trapo, una historia; cada historia, una sonrisa."</p>
        <p class="frase-final">¬°Que tengas un d√≠a Cat-t√°stico! ‚ú®</p>
        <button id="btn-inicio" class="gabby-button bounce-button">üè† Volver al inicio</button>
    </div>

    <div id="page-certificado" class="page">
        <div class="certificado-content">
            <h1>¬°Feliz Cumplea√±os!</h1>
            <div class="certificado-body">
                Para nuestra s√∫per estrella
                <br>
                <span class="campo-static">Mar√≠a Jos√©</span>
                <br>
                ¬°Que todos tus deseos se hagan realidad!
                <br>
                Con mucho cari√±o,
                <br>
                <span class="campo-rellenable" id="cert-de">Luz Elena y Valentina</span>
            </div>
            <button id="btn-volver-historia" class="gabby-button">Volver</button>
        </div>
    </div>

    <div id="sorpresa-popup">
        <div id="confetti-container"></div>
        <div class="sorpresa-content">
            <button class="close-popup" id="btn-cerrar-popup">&times;</button>
            <div id="typewriter-text"></div>
        </div>
    </div>

    <audio id="sound-background" src="https://archive.org/download/gabbys-dollhouse-theme-song/Gabby%27s%20Dollhouse%20Theme%20Song.mp3" loop preload="auto"></audio>
    
    <audio id="sound-magic" src="gabby_magia.mp3" preload="auto"></audio>
    <audio id="sound-click" src="gabby_click.mp3" preload="auto"></audio>
    <audio id="sound-bounce" src="gabby_rebote.mp3" preload="auto"></audio>


    <script>
        /* --- L√≥gica de Navegaci√≥n y Sonidos (Sin cambios) --- */
        const pages = document.querySelectorAll('.page');
        const btnComenzar = document.getElementById('btn-comenzar');
        const btnEntrar = document.getElementById('btn-entrar');
        const btnSorpresa = document.getElementById('btn-sorpresa');
        const btnInicio = document.getElementById('btn-inicio');
        const btnCerrarPopup = document.getElementById('btn-cerrar-popup');
        const popup = document.getElementById('sorpresa-popup');
        
        const btnCertificado = document.getElementById('btn-certificado');
        const btnVolverHistoria = document.getElementById('btn-volver-historia');
        
        const soundMagic = document.getElementById('sound-magic');
        const soundClick = document.getElementById('sound-click');
        const soundBounce = document.getElementById('sound-bounce');
        const soundBackground = document.getElementById('sound-background');
        
        soundBackground.volume = 0.3; 

        function goToPage(pageId) {
            pages.forEach(page => {
                page.classList.remove('active');
            });
            const newPage = document.getElementById(pageId);
            newPage.classList.add('active');
            newPage.scrollTop = 0;
        }

        function playSound(sound) {
            var promise = sound.play();
            if (promise !== undefined) {
                promise.then(_ => {
                    sound.currentTime = 0;
                }).catch(error => {
                    console.log("Reproducci√≥n bloqueada. Se requiere interacci√≥n.");
                });
            }
        }
        
        function unlockAudio() {
            soundMagic.play(); soundMagic.pause(); soundMagic.currentTime = 0;
            soundClick.play(); soundClick.pause(); soundClick.currentTime = 0;
            soundBounce.play(); soundBounce.pause(); soundBounce.currentTime = 0;
            soundBackground.play(); soundBackground.pause(); soundBackground.currentTime = 0;
            
            document.body.removeEventListener('click', unlockAudio);
            document.body.removeEventListener('touchstart', unlockAudio);
        }
        document.body.addEventListener('click', unlockAudio);
        document.body.addEventListener('touchstart', unlockAudio);

        /* --- Eventos de Botones --- */
        
        btnComenzar.addEventListener('click', (e) => {
            e.stopPropagation();
            playSound(soundMagic);
            
            if (soundBackground.paused) {
                soundBackground.play().catch(e => console.log("Error al iniciar m√∫sica de fondo"));
            }
            
            goToPage('page-portada');
        });

        btnEntrar.addEventListener('click', (e) => {
            e.stopPropagation();
            playSound(soundClick);
            goToPage('page-historia');
        });

        btnInicio.addEventListener('click', (e) => {
            e.stopPropagation();
            playSound(soundBounce);
            setTimeout(() => {
                goToPage('page-bienvenida');
            }, 300);
        });
        
        /* L√≥gica de la Sorpresa */
        btnSorpresa.addEventListener('click', (e) => {
            e.stopPropagation();
            playSound(soundMagic); // Sonido m√°gico para la sorpresa
            popup.classList.add('active');
            startConfettiRain();
            
            const textoSorpresa = "¬°Feliz Cumplea√±os, Mar√≠a Jos√©! ¬°Eres s√∫per Gatit√°stica! üéÇ‚ú®";
            startTypewriter(textoSorpresa, 'typewriter-text');
        });

        btnCerrarPopup.addEventListener('click', (e) => {
            e.stopPropagation();
            popup.classList.remove('active');
            stopConfettiRain();
        });
        
        /* L√≥gica del Certificado (Tarjeta) */
        
        function popularCertificado() {
            const urlParams = new URLSearchParams(window.location.search);
            const de = urlParams.get('de'); // Busca el par√°metro "de"
            const elDe = document.getElementById('cert-de');
            
            if (de) {
                elDe.textContent = de; // Lo rellena si existe
            } else {
                elDe.textContent = "Luz Elena y Valentina"; 
            }
        }
        
        btnCertificado.addEventListener('click', (e) => {
            e.stopPropagation();
            playSound(soundClick);
            popularCertificado(); // Rellena la tarjeta
            goToPage('page-certificado');
        });
        
        btnVolverHistoria.addEventListener('click', (e) => {
            e.stopPropagation();
            playSound(soundClick);
            goToPage('page-historia');
        });
        
        /* --- Funciones de Efectos --- */

        function startTypewriter(txt, elementId) {
            let i = 0;
            const speed = 90;
            const target = document.getElementById(elementId);
            target.innerHTML = '';
            
            function type() {
                if (txt.substring(i, i + 4).toLowerCase() === '<br>') {
                    target.innerHTML += '<br>';
                    i += 4;
                }
                
                if (i < txt.length) {
                    target.innerHTML += txt.charAt(i);
                    i++;
                    setTimeout(type, speed);
                }
            }
            type();
        }

        const confettiContainer = document.getElementById('confetti-container');
        let rainInterval;
        const confettiChars = ['‚ú®', 'üéâ', 'üíñ', 'üåü', 'ü•≥', 'üå∏'];

        function startConfettiRain() {
            stopConfettiRain();
            rainInterval = setInterval(createConfetti, 100);
        }

        function stopConfettiRain() {
            clearInterval(rainInterval);
            confettiContainer.innerHTML = '';
        }

        function createConfetti() {
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');
            confetti.innerText = confettiChars[Math.floor(Math.random() * confettiChars.length)];
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.animationDuration = (Math.random() * 2) + 3 + 's';
            confettiContainer.appendChild(confetti);
            setTimeout(() => {
                confetti.remove();
            }, 5000);
        }
    </script>
</body>
</html>
